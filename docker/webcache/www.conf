<VirtualHost *:80>

   ServerName www.motorbrot.org
   ServerAlias motorbrot.org
   ServerAlias www.motorbrot.local
   ServerAlias motorbrot.local
   DocumentRoot /var/www/vhosts/www
   ErrorLog /var/log/apache2/wwwerr.log
   TransferLog /var/log/apache2/www-access.log
   DirectoryIndex index.html

   RewriteEngine  on
   RewriteRule    "^/content/slimpogrine(.*)$"  "$1" [PT]

   # Configure mod_cache
   CacheEnable disk /
   CacheIgnoreNoLastMod On
   CacheIgnoreCacheControl On
   CacheRoot /var/cache/httpd/slimpogrine
   CacheDefaultExpire 10

   # Configure mod_expire
   ExpiresActive On
   ExpiresDefault "access plus 1 month"
   ExpiresByType text/html "access plus 10 seconds"
   ExpiresByType application/json "access plus 10 seconds"
   ExpiresByType image/gif "access plus 1 year"
   ExpiresByType image/jpeg "access plus 1 year"
   ExpiresByType image/png "access plus 1 year"
   ExpiresByType text/css "access plus 1 month"
   ExpiresByType text/javascript "access plus 1 month"
   ExpiresByType application/javascript "access plus 1 month"

   # Configure Proxy
   ProxyPassInterpolateEnv On
   ProxyPass /.well-known !
   ProxyPass /ERROR !

   ##################################################
   #   U R L   R E W R I T E S
   ##################################################

   # Well-known paths that need to pass
   ProxyPass /apps/slimpogrine/css_zen_garden/ http://${RENDERER_URL}:8080/apps/slimpogrine/css_zen_garden/ connectiontimeout=10 timeout=60 retry=0 interpolate
   ProxyPass /favicon.ico http://${RENDERER_URL}:8080/apps/slimpogrine/css_zen_garden/favicon.ico connectiontimeout=10 timeout=60 retry=0 interpolate

   # Without path -> home.html
   ProxyPassMatch "^/$" "http://${RENDERER_URL}:8080/content/slimpogrine/home.html" connectiontimeout=10 timeout=60 retry=0 interpolate

   # When path does NOT start with /content/slimpogrine or /slimpogrine
   # assume URL shortening has worked and make it long again requesting Sling
   ProxyPassMatch "^(?!(\/content)?\/slimpogrine)/(.*)" "http://${RENDERER_URL}:8080/content/slimpogrine/$2" connectiontimeout=10 timeout=60 retry=0 interpolate

   # Unshortend URLs starting with /content/slimpogrine pass as they are
   ProxyPass /content/slimpogrine/ http://${RENDERER_URL}:8080/content/slimpogrine/ connectiontimeout=10 timeout=60 retry=0 interpolate

   # Half-shortend URLs starting with /slimpogrine
   # When no Sling-Mappings are configured for the domain, ResourceResolver.map(path) just cuts of /content
   ProxyPass /slimpogrine/ http://${RENDERER_URL}:8080/content/slimpogrine/ connectiontimeout=10 timeout=60 retry=0 interpolate

   # OUTGOING Sling redirects have full URL including wrong docker-host. Cut it off
   ProxyPassReverse /content/slimpogrine/ http://${RENDERER_URL}:8080/content/slimpogrine/ interpolate

   # In case of non-existing resource, default Sling mechanism kicks in and redirect to login-page.
   # We don't want that on this domain so as quick hack we redirect to homePage with non-existing 404-cssId in suffix
   ProxyPassReverse /home.html/404 http://${RENDERER_URL}:8080/system/sling/form/login interpolate

   ##################################################
   #   E-N-D of U R L   R E W R I T E S
   ##################################################

   # Security / Hardening
   AllowEncodedSlashes on
   RewriteRule "^.+\..*\.json" - [F,L]
   RewriteCond %{REQUEST_METHOD} ^(delete|post|trace|track) [NC]
   RewriteRule .* - [F,L]
   Header set X-Frame-Options SAMEORIGIN
   Header set X-XSS-Protection "1; mode=block"
   Header set X-Content-Type-Options "nosniff"

   # Compress text files
   AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json


</VirtualHost>
